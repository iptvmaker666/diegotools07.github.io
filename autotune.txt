{set:gjson|{json.guild}}{set:tier|{traversejson:premium_tier|{get:gjson}}}{set:mb|{if:{get:tier}|=|3|then:100|else:{if:{get:tier}|=|2|then:50|else:{if:{get:tier}|=|1|then:10|else:10}}}}{set:bytes|{math:{get:mb}*1048576}}{if:{arg}|=|help|then:# WELCOME TO AUTOTUNE BOT NSB VERSION!
How to use it: 
.t {tagname} (url)
If you want to search YouTube videos type .t {tagname} youtube "Video title" and the video url will be automatically returned to be loaded.
If you want to use iscript to process the file type ".t {tagname} alt (url)"
-# Tag created by darryl_edits07. |else:{choose:Autotunebot in Notsobot? No way!|{mention:{randuser}} got blocked for banned content! /j|Your autism, sire.|# haha yes bot make the best ytp videos ever!|best revival ever|YouTube shorts has much brainrot|(â â§â â˝â âŚâ )|Your video is done}
{if:{arg}|=|alt|then:{eval:{sh:load {or:{av}|{av:0}}
load {if:{arg:1}|=|youtube|then:{search.youtube:{ARG:2}}|else:{arg:1}}

set -e
curl -sSL "https://github.com/GanerCodes/AutotuneBot/raw/refs/heads/main/autotune.exe" -o "autotune.exe"
chmod +x "autotune.exe"

hz=$(ffprobe -i $FILE_1 -show_entries stream=sample_rate -v error -of csv="p=0")
duration=$(ffprobe -i $FILE_1 -show_entries format=duration -v error -of csv="p=0")
carrier="carrier_$RANDOM.wav"
modulator="index_$RANDOM.wav"
autotuned="at_$RANDOM.wav"
SECONDS=0

ffmpeg -loglevel error -i $FILE_1 -vn -ac 1 -f wav $modulator || { echo ":warning: An error has occurred, exiting command! (Modulator error)"; exit 1; }
ffmpeg -loglevel error -stream_loop -1 -i $FILE_2 -vn -ac 1 -ar "$hz" -t $duration -f wav $carrier || { echo ":warning: An error has occurred, exiting command! (Carrier error)"; exit 1; }
wine cmd &>/dev/null && wine autotune.exe -q -b 75 $modulator $carrier ./output/$autotuned || { echo ":warning: An error has occurred, exiting command! (Autotune error)"; exit 1; }
cd output
ls -lh |& tee -a
echo "-# Command took ${SECONDS}s"}{mscriptmaybeurl:load {or:{av}|{av:0}} m
load FILE_1 a
repeatduration a md
audioputreplace m a true
render m}}|else:{sh:load {or:{av}|{av:0}}
load {if:{arg}|=|youtube|then:{search.youtube:{args:1}}|else:{arg}}
load https://github.com/GanerCodes/AutotuneBot/raw/refs/heads/main/autotune.exe
hz=$(ffprobe -i "$FILE_1" -show_entries stream=sample_rate -v error -of csv="p=0")
duration=$(ffprobe -i "$FILE_1" -show_entries format=duration -v error -of csv="p=0")
carrier="carrier_$RANDOM.wav"
modulator="index_$RANDOM.wav"
dir="./autotuned_$RANDOM"
autotuned="$dir/at_$RANDOM.wav"
log="log_$RANDOM.log"
SECONDS=0
mkdir "$dir"
out="a_${RANDOM}_$(basename $FILE_1)"
LIMIT_BYTES={get:bytes}
rate="$hz"

  if (( rate == 48000 )); then

    ffmpeg -loglevel error -i "$FILE_1" -vn -ac 1 -f wav "$modulator" \
      2> $log || { echo ":warning: An error has occurred, exiting command! (Modulator error)"; exit 1; } 

    ffmpeg -loglevel error -stream_loop -1 -i "$FILE_2" -vn -ac 1 -ar "$hz" -t "$duration" -f wav "$carrier" \
      2> $log || { echo ":warning: An error has occurred, exiting command! (Carrier error)"; exit 1; } 

  elif (( rate > 48000 )); then

    ffmpeg -loglevel error -i "$FILE_1" -vn -ac 1 -ar 48000 -f wav "$modulator" \
      2> $log || { echo ":warning: An error has occurred, exiting command! (Modulator error)"; exit 1; } 

    ffmpeg -loglevel error -stream_loop -1 -i "$FILE_2" -vn -ac 1 -ar 48000 -t "$duration" -f wav "$carrier" \
      2> $log || { echo ":warning: An error has occurred, exiting command! (Carrier error)"; exit 1; } 

  else # rate < 48000

    ffmpeg -loglevel error -i "$FILE_1" -vn -ac 1 -f wav "$modulator" \
      2> $log || { echo ":warning: An error has occurred, exiting command! (Modulator error)"; exit 1; } 

    ffmpeg -loglevel error -stream_loop -1 -i "$FILE_2" -vn -ac 1 -ar "$hz" -t "$duration" -f wav "$carrier" \
      2> $log || { echo ":warning: An error has occurred, exiting command! (Carrier error)"; exit 1; } 

  fi

  wine cmd &>/dev/null && wine "$FILE_3" -q -b 75 "$modulator" "$carrier" "$autotuned" \
    2> $log || { echo ":warning: An error has occurred, exiting command! (Autotune error)"; exit 1; } 

  ffmpeg -loglevel error -i "$FILE_1" -stream_loop -1 -i "$autotuned" -map 0:v? -map 1 -shortest "$out" \
    2> $log || { echo ":warning: An error has occurred, exiting command! (Processing error)"; exit 1; } 

  SIZE=$(stat -c%s "$out" || echo 0)
  cat $log
  
    if [ "$SIZE" -le "$LIMIT_BYTES" ]; then  
    echo "**Filesize: $(($SIZE / 1048576)) mb / $(($LIMIT_BYTES / 1048576)) mb**"
    mv "$out" ./output
    else
   RESP=$(curl -s \
    -F 'reqtype=fileupload' \
    -F "fileToUpload=@$out" \
    https://catbox.moe/user/api.php)

  echo "**:warning: File has reached the $(($LIMIT_BYTES / 1048576)) mb upload limit ($(($SIZE / 1048576)) mb), but you can watch it here: $RESP **"
fi
rm -rf "$dir"
echo "-# Command took ${SECONDS}s"}}}
